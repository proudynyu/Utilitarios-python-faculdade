/*
 * LCD.h
 *
 * Created: 20/05/2020 14:26:06
 *  Author: Igor
 */ 

#ifndef LCD_H_
#define LCD_H_

#include "HeaderLCD.h"

const unsigned char bigNum[] PROGMEM = {
	0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1F,
	0x1F, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10,
	0x1F, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
	0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
	0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F,
	0x1F, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1F,
	0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x1F, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1F,
};

const unsigned char num_table[10][4] PROGMEM = {
	{ 0x01, 0x02, 0x4C, 0x00 },	// 0
	{ 0x20, 0x7C, 0x20, 0x7C },	// 1
	{ 0x04, 0x05, 0x4C, 0x5F },	// 2
	{ 0x04, 0x05, 0x5F, 0x00 }, // 3
	{ 0x4C, 0x00, 0x20, 0x03 }, // 4
	{ 0x07, 0x04, 0x5F, 0x00 }, // 5
	{ 0x07, 0x04, 0x4C, 0x00 }, // 6
	{ 0x06, 0x02, 0x20, 0x03 }, // 7
	{ 0x07, 0x05, 0x4C, 0x00 }, // 8
	{ 0x07, 0x05, 0x20, 0x03 }, // 9
};

void writeLCD(unsigned char c, unsigned char instruction) {
	DISPLAY = c;
	
	if (instruction == 0) clr_bit(CONTROL, RS);
	else set_bit(CONTROL, RS);
	
	pulso();
	
	if (instruction == 0 && c < 4) _delay_ms(2);
}

void initLCD() {
	clr_bit(CONTROL, RS);
	_delay_ms(10);
	
	DISPLAY = 0x38;
	
	pulso();
	_delay_ms(200);
	pulso();
	pulso();
	
	writeLCD(OFF, 0);
	writeLCD(CLEAR, 0);
	writeLCD(ON, 0);
	writeLCD(0x8F, 0);
}

void createChar() {
	unsigned char indice = 0, posicao = 0x40;
	
	for (char i = 0; i < 8; i++) {
		writeLCD(posicao, 0);
		
		for (char linha = 0; linha < 7; linha++) {
			writeLCD(pgm_read_byte(&bigNum[linha+indice]), 1);
		}
		writeLCD(0x00, 1);
		
		indice += 7;
		posicao += 8;
	}
}

void writeChar(unsigned char begining, unsigned char num) {
	writeLCD(begining, 0);
	writeLCD(pgm_read_byte(&num_table[num][0]), 1);
	writeLCD(pgm_read_byte(&num_table[num][1]), 1);
	begining += 64;
	writeLCD(begining, 0);
	writeLCD(pgm_read_byte(&num_table[num][2]), 1);
	writeLCD(pgm_read_byte(&num_table[num][3]), 1);
}

#endif /* LCD_H_ */